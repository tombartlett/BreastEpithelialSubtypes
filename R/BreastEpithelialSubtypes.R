BreastEpithelialSubtypes<-function(dataB,hierarchical=T){

  centLumnBasl<-structure(c(0.950819672131147, 0.934782608695652, 0.880952380952381,
                            1, 0.886792452830189, 0.9, 0.907284768211921, 0.969387755102041,
                            0.951612903225806, 0.944444444444444, 0.939393939393939, 0.761904761904762,
                            1, 0.837837837837838, 0.916666666666667, 1, 0.947368421052632,
                            0.936170212765957, 0.875, 0.761904761904762, 0.890625, 0.915254237288136,
                            0.16, 0.166666666666667, 0.222222222222222, 0.0666666666666667,
                            0.413793103448276, 0.193548387096774, 0.363636363636364, 0.0238095238095238,
                            0.325, 0, 0.0909090909090909, 0.0606060606060606, 0.285714285714286,
                            0.19047619047619, 0.269230769230769, 0.106382978723404, 0.0980392156862745,
                            0.242424242424242, 0.88, 0.75, 0.0689655172413793, 0.928571428571429,
                            0.121212121212121, 0.811320754716981, 0.970588235294118, 0.956521739130435,
                            0.037037037037037, 0.769230769230769, 0.96, 0.861111111111111,
                            0.5, 0, 0.482758620689655, 0.416666666666667, 0.946902654867257,
                            0.956521739130435, 0.0862068965517241, 0.181818181818182, 0.111111111111111,
                            0.222222222222222, 0.137931034482759, 0.153846153846154, 0.184210526315789,
                            0.0689655172413793, 0.25, 0.0813953488372093, 0.104166666666667,
                            0, 0.178571428571429, 0.125, 0.216216216216216, 0.0952380952380952,
                            0.114285714285714, 0.133333333333333, 0.111111111111111, 0.0416666666666667,
                            0.111111111111111, 0.156862745098039, 0.72, 0.846153846153846,
                            0.704545454545455, 0.810810810810811, 0.90625, 0.661016949152542,
                            0.951219512195122, 0.512820512820513, 0.974358974358974, 0.772727272727273,
                            0.91304347826087, 0.714285714285714, 0.84, 0.92, 0.833333333333333,
                            0.827586206896552, 0.925, 0.941176470588235, 0.836734693877551,
                            0.555555555555556, 0.0416666666666667, 0.972222222222222, 0.606060606060606,
                            0.605263157894737, 0.96551724137931, 0.954545454545455, 0.128205128205128,
                            0.666666666666667, 0.939393939393939, 0.67741935483871, 1, 0.810810810810811,
                            0.934426229508197, 0.767123287671233, 0.953488372093023, 0.92,
                            0.962025316455696, 0.962264150943396, 0.892156862745098, 1, 0.953846153846154,
                            0.857142857142857, 0.960199004975124, 0.970588235294118, 1, 0.966386554621849,
                            0.91304347826087, 0.979166666666667, 0.98, 0.96875, 0.976744186046512,
                            0.956521739130435, 1, 0.925925925925926, 0.909090909090909, 0.966666666666667,
                            0.94, 0.901234567901235, 0.689655172413793, 0.936507936507937,
                            0.94, 0.7, 0.970588235294118, 0.702702702702703, 0.844444444444444,
                            0.962264150943396, 0.952380952380952, 1, 1, 0.869047619047619,
                            0.875, 0.926829268292683, 0.774193548387097, 0.871428571428571,
                            0.914893617021277, 0.909090909090909, 0.463414634146341, 0.307692307692308,
                            0.275, 0.35, 0.382352941176471, 0.227272727272727, 0.357142857142857,
                            0.391304347826087, 0.354838709677419, 0.224489795918367, 0.439024390243902,
                            0.461538461538462, 0.214285714285714, 0.2, 0.186046511627907,
                            0.191666666666667, 0.254385964912281, 0.434782608695652), .Dim = c(58L,
                                                                                               3L), .Dimnames = list(c("cg00318877", "cg02776119", "cg05686467",
                                                                                                                       "cg06058699", "cg06525193", "cg06681656", "cg07703701", "cg11180129",
                                                                                                                       "cg13312976", "cg13983849", "cg13985135", "cg15084470", "cg16252122",
                                                                                                                       "cg16377367", "cg18393905", "cg19241089", "cg19712745", "cg19793807",
                                                                                                                       "cg20996887", "cg22146642", "cg23501468", "cg23934819", "cg04960880",
                                                                                                                       "cg07850274", "cg10716760", "cg11259254", "cg12510203", "cg14453449",
                                                                                                                       "cg14968388", "cg16129213", "cg17375269", "cg19517912", "cg19857361",
                                                                                                                       "cg20103263", "cg23741159", "cg24644113", "cg24828322", "cg24894318",
                                                                                                                       "cg25345805", "cg26576172", "cg00656991", "cg01613725", "cg02389634",
                                                                                                                       "cg03074579", "cg06517794", "cg08678429", "cg09433558", "cg11116035",
                                                                                                                       "cg12555369", "cg13217184", "cg13713148", "cg20626840", "cg20834587",
                                                                                                                       "cg21250061", "cg21579982", "cg22172309", "cg24326223", "cg24688636"
                                                                                               ), c("lumin.prog", "lumin.mat", "basal")))

  cellProps<-epidish(beta.m=dataB,ref.m=centLumnBasl)[["estF"]]
  if(hierarchical){
    data(centEpiFibFatIC.m)
    tempProps<-epidish(beta.m=dataB,ref.m=centEpiFibFatIC.m)[["estF"]]
    cellProps<-cbind(cellProps*tempProps[,"Epi"],tempProps[,colnames(tempProps)!="Epi"])
    rm(list="tempProps")
  }

  return(cellProps)

}
